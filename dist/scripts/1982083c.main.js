function log(){console.log.apply(console,GeneralUtils.getArgs(arguments))}function XY(a,b){Array.isArray(arguments[0])&&2===arguments[0].length?(this.x=arguments[0][0],this.y=arguments[0][1]):(this.x=a||0,this.y=b||0)}function XYZ(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0}function Dimension2d(a,b){this.w=a||100,this.h=b||100}function Dimension3d(a,b,c){this.w=a||100,this.h=b||100,this.d=c||100}function Face(a,b,c){this.width=a.w,this.height=a.h,this.position=b,this.rotation=c}function Shadow(a,b,c,d){Face.call(this,new Dimension2d("100%","100%"),b,new XYZ(-90,0,0)),this.opacity=c,d=d?CssUtils.clipPath(d):"",this.node=HtmlUtils.createElem(a.node),CssUtils.inject(this.node,CssUtils.size(this.width,this.height),CssUtils.transform(this.position.x,this.position.y,this.position.z,this.rotation.x,this.rotation.y,this.rotation.z),CssUtils.origin(0,100,0),CssUtils.bgImage(TEXTURES.SHADOW),CssUtils.opacity(this.opacity),d)}function Element3D(a,b,c){this.width=a.w,this.height=a.h,this.depth=a.d,this.position=b,this.rotation=c}function Square(a,b,c,d,e){Face.call(this,b,c,d),this.color=e,Face.prototype.insert.call(this,a,"square"),CssUtils.inject(this.node,CssUtils.bgColor(this.color))}function Shape(a,b,c,d,e,f){Face.call(this,b,c,d),Face.prototype.insert.call(this,a,"shape");var g=e.top,h=e.left,i=GeneralUtils.getTrigo(f),j=-h*i.cos-g*i.sin,k=h*i.sin-g*i.cos;this.cutter=HtmlUtils.createElem(this.node,null,"cutter"),CssUtils.inject(this.cutter,CssUtils.absolutePosition(g,h),CssUtils.transform(0,0,0,0,0,f)),this.filler=HtmlUtils.createElem(this.cutter,null,"filler"),CssUtils.inject(this.filler,CssUtils.absolutePosition(k,j),CssUtils.transform(0,0,0,0,0,-f)),CssUtils.inject(this.node,CssUtils.origin((g+100)/2,(h+100)/2,0))}function EqTri(a,b,c,d){this.node=HtmlUtils.createElem(a.node,null,"eqTri"),this.width=b.w,this.height=b.h,this.position=c,this.rotation=d;var e=30,f=new Shape(this,b,c,d,{top:31.8,left:68},e),g=new Shape(this,b,c,d,{top:31.8,left:-68},-e);CssUtils.inject(f.cutter,CssUtils.absolutePosition(0,0),CssUtils.origin(0,100,0)),CssUtils.inject(f.filler,CssUtils.bgPosition(-150)),CssUtils.inject(g.cutter,CssUtils.absolutePosition(0,0),CssUtils.origin("bottom","right","")),CssUtils.inject(g.filler,CssUtils.bgPosition(150))}function Prism(a,b,c,d,e,f){function g(a){a.insert(this,null),CssUtils.inject(a.node,CssUtils.bgImage(f))}Element3D.call(this,b,c,d),Element3D.prototype.insertHolder.call(this,a,"letter_y"),this.texture=f,this.front=new Face(new Dimension2d(this.width,this.height),new XYZ(0,0,this.depth/2),new XYZ),this.rear=new Face(new Dimension2d(this.width,this.height),new XYZ(0,0,-this.depth/2),new XYZ(0,0,0)),[this.rear,this.front].forEach(function(a){g.call(this,a),CssUtils.inject(a.node,CssUtils.clipPath(e),CssUtils.bgImage("http://i.imgur.com/IEiqEV0.jpg"))}.bind(this)),this.shell=[];for(var h=0,i=4*e[0][0],j=4*e[0][1];h<e.length;h++){var k=e[h+1]?h+1:0,l=GeneralUtils.pointsDistance(new XY(e[h]),new XY(e[k])),m=this.width*l.dist/100,n=-this.width/2+m/2+i,o=-this.width/2+j;this.shell[h]=new Face(new Dimension2d(m,this.depth),new XYZ(n,o,0),new XYZ(90,l.deg,0)),g.call(this,this.shell[h]),CssUtils.inject(this.shell[h].node,CssUtils.origin(0,50,0));var p=GeneralUtils.getTrigo(l.deg);i+=m*p.cos,j+=m*p.sin}}function addRoundness(a,b,c,d,e){function f(a){return parseFloat(Math.round(100*a)/100).toFixed(2)}for(var g,h,i,j=new XY(a),k=new XY(b),l=GeneralUtils.pointsDistance(j,k),m={w:l.dist/2,h:l.dist/2*c},n=new XY(j.x+l.delX/2,j.y+l.delY/2),o=l.rad,p=[a],q=1,r=Math.sin(o),s=Math.cos(o);d>=q;q++){g=Math.PI-Math.PI/(d+1)*q,e&&(g=-g),h=m.w*Math.cos(g),i=m.h*Math.sin(g);var t=s*h-r*i,u=r*h+s*i;p.push([f(t+n.x),f(u+n.y)])}return p.push(b),p}function Viewport(){this.perspective=1700,this.node=HtmlUtils.createElem("body","viewport2"),CssUtils.inject(this.node,"position: relative; overflow: hidden; width: 100%; height: 100%; background: #100028;",CssUtils.perspective(this.perspective))}function Camera(a){this.node=HtmlUtils.createElem(a.node,"camera2"),this.rotation=new XYZ,this.perspective=a.perspective,CssUtils.inject(this.node,CssUtils.base())}function World(a){this.node=HtmlUtils.createElem(a,"world2"),this.position=new XYZ,CssUtils.inject(this.node,CssUtils.base())}var GeneralUtils=function(){return{getArgs:function(a,b){return b=b||0,Array.prototype.slice.call(a,b)},getArrayArgs:function(a,b){var c=GeneralUtils.getArgs(a,b);return Array.isArray(c[0])?c:[c]},toRadians:function(a){return a*(Math.PI/180)},toDegrees:function(a){return a*(180/Math.PI)},getTrigo:function(a){var b=this.toRadians(a);return{sin:Math.sin(b),cos:Math.cos(b)}},pointsDistance:function(a,b){var c=b.x-a.x,d=b.y-a.y,e=Math.atan2(d,c),f=GeneralUtils.toDegrees(e);return{delX:c,delY:d,dist:Math.sqrt(Math.pow(c,2)+Math.pow(d,2)),deg:f,rad:e}},getNewPointByDistAndAngle:function(a,b,c){var d=GeneralUtils.toRadians(b);return new XY(a.x+Math.cos(d)*c,a.y+Math.sin(d)*c)},stringCreator:function(a){return function(){function b(b,c){if("string"!=typeof b)throw"property should be a string";if("string"!=typeof c)throw"content should be a string";return a(b,c)}var c=GeneralUtils.getArrayArgs(arguments);return c.reduce(function(a,c){return a+b(c[0],c[1])},"")}}}}(),HtmlUtils=function(){return{createElem:function(a,b,c,d){d=d||"div";var e=document.createElement(d);return b&&e.setAttribute("id",b),c&&(e.className=c),a instanceof Element||(a=document.querySelector(a)),a.insertBefore(e,a.firstChild),e},createShape:function(a,b){}}}(),CssUtils=function(){var a=document.documentElement.style,b=void 0!==a.WebkitTransform&&"-webkit-"||void 0!==a.MozTransform&&"-moz-"||void 0!==a.msTransform&&"-ms-"||"",d=1;return d&=void 0!==a.backgroundBlendMode,{inject:function(a){a.style.cssText=GeneralUtils.getArgs(arguments,1).reduce(function(a,b){return a+b},a.style.cssText)},unit:function(a,b){if(a=a||0,"string"==typeof a)return a;if("string"!=typeof b)throw"defaultUnit is not a string";return a.toFixed(2)+b},strProperties:GeneralUtils.stringCreator(function(a,b){return a+":"+b+";"}),strInnerProperties:GeneralUtils.stringCreator(function(a,b){return a+"("+b+")"}),absolutePosition:function(a,b){return this.strProperties(["position","absolute"],["top",this.unit(a,"%")],["left",this.unit(b,"%")])},base:function(){return this.absolutePosition(50,50)+this.strProperties([b+"transform-style","preserve-3d"])},bgPosition:function(a,b){return this.strProperties("background-position",this.unit(a,"%")+" "+this.unit(b,"%"))},bgImage:function(a,b){return this.strProperties(["background-size",b?b:"cover"],["background-image",this.strInnerProperties("url",a)])},clipPath:function(a){return this.strProperties(b+"clip-path",this.strInnerProperties("polygon",a.map(function(a){return a[0]+"% "+a[1]+"%"}).toString()))},opacity:function(a){return this.strProperties("opacity",a)},origin:function(a,c,d){return this.strProperties(b+"transform-origin",this.unit(a,"%")+" "+this.unit(c,"%")+" "+this.unit(d,"px"))},size:function(a,b){return this.strProperties(["width",this.unit(a,"px")],["height",this.unit(b,"px")],["margin-left",this.unit(-(a/2),"px")],["margin-top",this.unit(-(b/2),"px")])},transform:function(a,c,d,e,f,g,h,i){return this.strProperties(b+"transform",this.strInnerProperties(["translate3d",[this.unit(a,"px"),this.unit(c,"px"),this.unit(d,"px")].toString()],["rotateX",this.unit(e,"deg")],["rotateY",this.unit(f,"deg")],["rotateZ",this.unit(g,"deg")],["skewX",this.unit(h,"deg")],["skewY",this.unit(i,"deg")]))},transform2:function(a,c,d,e,f,g,h,i){return this.strProperties(b+"transform",this.strInnerProperties(["translate3d",[this.unit(a,"px"),this.unit(c,"px"),this.unit(d,"px")].toString()],["rotateX",this.unit(e,"deg")],["rotateY",this.unit(f,"deg")],["rotateZ",this.unit(g,"deg")],["skewX",this.unit(h,"deg")],["skewY",this.unit(i,"deg")]))},backface:function(a){var c=a?"hidden":"visible";return this.strProperties(b+"backface-visibility",c)},perspective:function(a){return this.strProperties(b+"perspective",this.unit(a,"px"))},bgColor:function(a){return this.strProperties("background",a)},wa:function(a){for(var b=0,d=0;d<L.length;d++)var e=L[d],e=c.k(c.add(e.u(),a))/(100+10*e.U),b=Math.max(b,1-e);return b},Y:function(a){return V(a.l)},n:function(a){var c=[],e=[],f=[],g=[],h="",i=CssUtils.Y(a);return i&&(c.push("-"==i.charAt(0)?i:"url("+i+")"),e.push("100% 100%"),f.push("0 0"),g.push("multiply")),c.push("url("+a.n.src+")"),e.push("auto"),f.push((a.n.x||0).toFixed(2)+"px -"+(a.n.y||0).toFixed(2)+"px"),a.n.ia&&(h+=b+"mask-image:url("+a.n.src+");"+b+"mask-position:"+(a.n.x||0).toFixed(2)+"px -"+(a.n.y||0).toFixed(2)+"px;"),c.length&&(h+="background:"+c.join()+";"),f.length&&(h+="background-position:"+f.join()+";"),e.length&&(h+="background-size: "+e.join()+";"),d&&g.length&&(h+="background-blend-mode: "+g.join()+";"),h}}}();Face.prototype.insert=function(a,b){this.node=HtmlUtils.createElem(a.node,null,b),CssUtils.inject(this.node,CssUtils.base(),CssUtils.size(this.width,this.height),CssUtils.transform(this.position.x,this.position.y,this.position.z,this.rotation.x,this.rotation.y,this.rotation.z))},Element3D.prototype.insertHolder=function(a,b){this.node=HtmlUtils.createElem(a.node,null,b),CssUtils.inject(this.node,CssUtils.base(),CssUtils.transform(this.position.x,this.position.y,this.position.z,this.rotation.x,this.rotation.y,this.rotation.z))},Square.prototype=Object.create(Face.prototype),Square.prototype.constructor=Square;var rndnss=14,ltrWdth=20,LetterCoordinates={A:[].concat([[80,100],[50,30],[37,60],[63,60],[69,74],[32,74],[20,100],[0,100],[50,0],[100,100]]),C:[].concat(addRoundness([100,100],[100,0],1,rndnss,!0),addRoundness([100,ltrWdth],[100,100-ltrWdth],1,rndnss,!1)),D:[].concat([[0,0]],addRoundness([ltrWdth,0],[ltrWdth,100],1,rndnss,!0),addRoundness([ltrWdth,100-ltrWdth],[ltrWdth,ltrWdth],1,rndnss,!1),[[ltrWdth,100],[0,100]]),E:[].concat([[0,0],[0,100],[50,100],[50,100-ltrWdth],[ltrWdth,100-ltrWdth],[ltrWdth,50+ltrWdth/2],[50,50+ltrWdth/2],[50,50-ltrWdth/2],[ltrWdth,50-ltrWdth/2],[ltrWdth,ltrWdth],[50,ltrWdth],[50,0]]),F:[].concat([[0,0],[0,100],[ltrWdth,100],[ltrWdth,50+ltrWdth/2],[50,50+ltrWdth/2],[50,50-ltrWdth/2],[ltrWdth,50-ltrWdth/2],[ltrWdth,ltrWdth],[50,ltrWdth],[50,0]]),H:[].concat([[0,0],[0,100],[ltrWdth,100],[ltrWdth,50+ltrWdth/2],[70-ltrWdth,50+ltrWdth/2],[70-ltrWdth,100],[70,100],[70,0],[70-ltrWdth,0],[70-ltrWdth,50-ltrWdth/2],[ltrWdth,50-ltrWdth/2],[ltrWdth,0]]),G:[].concat([[80,0]],addRoundness([50,0],[50,100],1,rndnss,!1),[[55.23,99.73],[65.45,97.55],[75,93.3],[83.46,87.16],[90.45,79.39],[95.68,70.34],[98.91,60.4],[100,50]],[[55,50],[50,50+.8*ltrWdth]],addRoundness([100-ltrWdth-2,50+.8*ltrWdth],[50,100-ltrWdth+2],.3,.5*rndnss,!0),addRoundness([45,100-ltrWdth+1],[55,ltrWdth],1,rndnss,!0),[[70,ltrWdth]]),L:[].concat([[0,0],[0,100],[50,100],[50,100-ltrWdth],[ltrWdth,100-ltrWdth],[ltrWdth,0]]),N:[].concat([[0,0],[0,100],[ltrWdth,100],[ltrWdth,1.5*ltrWdth],[100-ltrWdth,100],[100,100],[100,0],[100-ltrWdth,0],[100-ltrWdth,100-1.5*ltrWdth],[ltrWdth,0]]),M:[].concat([[0,0],[0,100],[ltrWdth,100],[ltrWdth,1.5*ltrWdth],[50,50],[100-ltrWdth,1.5*ltrWdth],[100-ltrWdth,100],[100,100],[100,0],[100-ltrWdth,0],[50,ltrWdth],[ltrWdth,0]]),O:[].concat(addRoundness([100,50],[0,50],1,rndnss,!0),addRoundness([0,49.9],[100,50],1,rndnss,!0),addRoundness([100-ltrWdth,50],[ltrWdth,50],1,rndnss,!1),addRoundness([ltrWdth,50.1],[100-ltrWdth,50],1,rndnss,!1)),T:[].concat([[50-ltrWdth/2,100],[50-ltrWdth/2,ltrWdth],[50-1.5*ltrWdth,ltrWdth],[50-1.5*ltrWdth,0],[50+1.5*ltrWdth,0],[50+1.5*ltrWdth,ltrWdth],[50+ltrWdth/2,ltrWdth],[50+ltrWdth/2,100]]),R:[].concat([[0,0]],addRoundness([2*ltrWdth,0],[2*ltrWdth,50+ltrWdth/2],1,rndnss,!0),[[50+ltrWdth,100],[50,100],[ltrWdth,50+ltrWdth/2],[ltrWdth,50-ltrWdth/2]],addRoundness([2*ltrWdth,50-ltrWdth/2],[2*ltrWdth,ltrWdth],1,rndnss,!1),[[ltrWdth,ltrWdth],[ltrWdth,100],[0,100]]),U:[].concat([[100,0]],addRoundness([100,50],[0,50],1,rndnss,!0),[[0,0],[ltrWdth,0]],addRoundness([ltrWdth,50],[100-ltrWdth,50],1,rndnss,!1),[[100-ltrWdth,0]]),V:[].concat([[0,0],[50,100],[100,0],[100-ltrWdth,0],[50,64],[ltrWdth,0]]),Y:[[0,0],[30,0],[50,30],[70,0],[100,0],[65,55],[65,100],[35,100],[35,55]]},TEXTURES={STONE:"./images/stone.png",GRASS:"./images/grass3.jpg",SHADOW:"./images/blackbox.jpeg"};Camera.prototype={updateRotation:function(a){this.rotation=a||this.rotation,CssUtils.inject(this.node,CssUtils.transform(0,0,this.perspective,this.rotation.x,this.rotation.y,0))}},World.prototype={constructor:World,updatePosition:function(a){this.position=a,CssUtils.inject(this.node,CssUtils.transform(a.x,a.y,a.z,0,0,0))}},window.onload=function(){function a(a){console.log("move "+a);var b,c=6,f=e.position,g=d.rotation;switch(a){case"forward":b=0;break;case"backward":b=180;break;case"right":b=90;break;case"left":b=270}var h=GeneralUtils.getTrigo(g.y+b);f.x-=c*h.sin,f.z+=c*h.cos,e.updatePosition(f)}function b(a){console.log("look "+a);var b=d.rotation;switch(a){case"up":b.x++;break;case"down":b.x--;break;case"right":b.y++;break;case"left":b.y--}d.updateRotation(b)}var c=new Viewport,d=new Camera(c);d.updateRotation(new XYZ(-10,0,60));var e=new World(d.node);e.updatePosition(new XYZ(0,800,-5e3));var f=new Square(e,new Dimension2d(1e4,1e4),new XYZ(0,200,0),new XYZ(90,0,0),"");CssUtils.inject(f.node,CssUtils.bgImage(TEXTURES.GRASS,"1000px"));var g=400,h=100,i=2e3,j=.5;"THREEDOM".split("").forEach(function(a,b,c){var d=c.length,f=180/(d-1)*b*j+90*(1-j),k=GeneralUtils.getTrigo(f),l=-k.cos*i,m=k.sin*i,n=-90+f,o=new Prism(e,new Dimension3d(g,g,h),new XYZ(l,0,m),new XYZ(0,n,0),LetterCoordinates[a],TEXTURES.STONE);o.Shadow=new Shadow(o.rear,new XYZ(0,-3,h/2),"0.3",LetterCoordinates[a])}),document.addEventListener("keydown",function(c){switch(c.keyCode){case 38:a("forward");break;case 39:a("right");break;case 40:a("backward");break;case 37:a("left");break;case 87:b("up");break;case 68:b("right");break;case 83:b("down");break;case 65:b("left")}})};